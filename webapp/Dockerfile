FROM node:12-slim as builder

ARG branch
ARG REACT_APP_GRAPHQL_HTTP_URL
ARG REACT_APP_API_URL
ARG REACT_APP_GRAPHQL_WS_URL
ARG REACT_APP_EOS_API_URL
ARG REACT_APP_EOS_API_HOST
ARG REACT_APP_EOS_API_PORT
ARG REACT_APP_EOS_API_PROTOCOL
ARG REACT_APP_EOS_CHAIN_ID
ARG REACT_APP_BLOCK_EXPLORER
ARG REACT_APP_NETWORK_MONITOR_URL

ENV REACT_APP_GRAPHQL_HTTP_URL $REACT_APP_GRAPHQL_HTTP_URL
ENV REACT_APP_API_URL $REACT_APP_API_URL
ENV REACT_APP_GRAPHQL_WS_URL $REACT_APP_GRAPHQL_WS_URL
ENV REACT_APP_EOS_API_URL $REACT_APP_EOS_API_URL
ENV REACT_APP_EOS_API_HOST $REACT_APP_EOS_API_HOST
ENV REACT_APP_EOS_API_PORT $REACT_APP_EOS_API_PORT
ENV REACT_APP_EOS_API_PROTOCOL $REACT_APP_EOS_API_PROTOCOL
ENV REACT_APP_EOS_CHAIN_ID $REACT_APP_EOS_CHAIN_ID
ENV REACT_APP_BLOCK_EXPLORER $REACT_APP_BLOCK_EXPLORER
ENV REACT_APP_NETWORK_MONITOR_URL $REACT_APP_NETWORK_MONITOR_URL

WORKDIR /usr/src/app

COPY package.json .

COPY yarn*.lock .

RUN yarn --frozen-lockfile

COPY . .

ENV GENERATE_SOURCEMAP false

RUN yarn build

FROM nginx:1.16.1-alpine as server

COPY --from=builder /usr/src/app/build /usr/share/nginx/html
COPY --from=builder /usr/src/app/nginx.conf /etc/nginx/conf.d/default.conf
